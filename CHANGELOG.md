# Changelog - –£–ª—É—á—à–µ–Ω–∏—è –±–∏–±–ª–∏–æ—Ç–µ—á–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã

## [2024-12-06] - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

### üîß –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Backend

#### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –±–∞–≥ —Å –ø–∞—Ä—Å–∏–Ω–≥–æ–º userID
- **–ü—Ä–æ–±–ª–µ–º–∞**: `book_access_handler.go` –∏ `book_file_handler.go` –ø—ã—Ç–∞–ª–∏—Å—å –ø–∞—Ä—Å–∏—Ç—å `userID` –∫–∞–∫ string, –Ω–æ middleware –∫–ª–∞–¥–µ—Ç `uuid.UUID`
- **–†–µ—à–µ–Ω–∏–µ**: –í—Å–µ handler'—ã —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç `middleware.GetUserFromContext(c)` helper
- **–§–∞–π–ª—ã**: 
  - `internal/handlers/book_access_handler.go`
  - `internal/handlers/book_file_handler.go`

#### –ê–¥–º–∏–Ω—ã –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä–∏ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å –≤—Å–µ –∫–Ω–∏–≥–∏
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ê–¥–º–∏–Ω—ã –Ω–µ –º–æ–≥–ª–∏ —á–∏—Ç–∞—Ç—å –∫–Ω–∏–≥–∏ –±–µ–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ BookAccess
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∞ role-based –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ `ServeFile()`:
  ```go
  role, _ := middleware.GetUserRoleFromContext(c)
  if role == models.RoleAdmin || role == models.RoleLibrarian {
      hasAccess = true
  } else {
      hasAccess, _ = h.accessService.CheckAccess(userID, bookFile.BookID)
  }
  ```
- **–§–∞–π–ª**: `internal/handlers/book_file_handler.go:95-105`

#### –£–ª—É—á—à–µ–Ω–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ GrantAccess
**–î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏:**
1. `user.IsActive` - –Ω–µ–ª—å–∑—è –≤—ã–¥–∞—Ç—å –¥–æ—Å—Ç—É–ø –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
2. `book.Status == BookStatusPublished` - —Ç–æ–ª—å–∫–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ –∫–Ω–∏–≥–∏
3. `group.IsActive` - —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ –≥—Ä—É–ø–ø—ã
4. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≥—Ä—É–ø–ø—ã (–Ω–µ –º–æ–ª—á–∞–ª–∏–≤–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è)
5. –ö—É–ø–ª–µ–Ω–Ω—ã–µ –∫–Ω–∏–≥–∏ (`AccessTypePurchase`) —Ç–µ–ø–µ—Ä—å –∏–º–µ—é—Ç —Å—Ä–æ–∫ 100 –ª–µ—Ç –≤–º–µ—Å—Ç–æ N –¥–Ω–µ–π
6. –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è `GrantedBy` –∏ `Notes` –¥–ª—è –∞—É–¥–∏—Ç–∞

**–§–∞–π–ª**: `internal/services/book_access_service.go:36-91`

### üÜï –ù–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

–°–æ–∑–¥–∞–Ω—ã 4 –Ω–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞:

#### 1. Collection (–ö–æ–ª–ª–µ–∫—Ü–∏–∏ –∫–Ω–∏–≥)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∫–Ω–∏–≥
- –ü—É–±–ª–∏—á–Ω—ã–µ/–ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
- Many-to-many —Å–≤—è–∑—å —Å –∫–Ω–∏–≥–∞–º–∏
- –ü–æ–ª—è: `name`, `description`, `is_public`, `cover_url`, `books_count`
- **–§–∞–π–ª**: `internal/models/collection.go`

#### 2. Bookmark (–ó–∞–∫–ª–∞–¥–∫–∏)
- –ó–∞–∫–ª–∞–¥–∫–∏ –≤ –∫–Ω–∏–≥–∞—Ö –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö
- –ó–∞–º–µ—Ç–∫–∏ –∫ –∑–∞–∫–ª–∞–¥–∫–∞–º
- –í–∞–∂–Ω—ã–µ/–æ–±—ã—á–Ω—ã–µ –∑–∞–∫–ª–∞–¥–∫–∏
- –¶–≤–µ—Ç–æ–≤–∞—è –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∞
- –ü–æ–ª—è: `book_id`, `file_id`, `page_number`, `title`, `notes`, `color`, `is_important`
- **–§–∞–π–ª**: `internal/models/bookmark.go`

#### 3. Annotation (–ê–Ω–Ω–æ—Ç–∞—Ü–∏–∏)
- 4 —Ç–∏–ø–∞: highlight, note, underline, strikeout
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
- –ü–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –ü—É–±–ª–∏—á–Ω—ã–µ/–ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏
- –ü–æ–ª—è: `type`, `page_number`, `content`, `selected_text`, `position_data`, `color`, `is_public`
- **–§–∞–π–ª**: `internal/models/annotation.go`

#### 4. Review (–û—Ç–∑—ã–≤—ã)
- –†–µ–π—Ç–∏–Ω–≥ –æ—Ç 1 –¥–æ 5 –∑–≤—ë–∑–¥
- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –æ—Ç–∑—ã–≤–∞
- –°–∏—Å—Ç–µ–º–∞ –ª–∞–π–∫–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–Ω–∏–≥–∞–º
- –ü–æ–ª—è: `rating`, `title`, `content`, `likes_count`, `is_public`
- **–§–∞–π–ª**: `internal/models/review.go`

### üé® –£–ª—É—á—à–µ–Ω–∏—è Frontend

#### –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

**–°–æ–∑–¥–∞–Ω—ã —É—Ç–∏–ª–∏—Ç—ã:**
1. `utils/formatters.ts` - –µ–¥–∏–Ω–æ–µ –º–µ—Å—Ç–æ –¥–ª—è –≤—Å–µ—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤:
   - `formatDate()` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã
   - `formatDateTime()` - –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è
   - `formatFileSize()` - —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
   - `daysRemaining()` - –¥–Ω–µ–π –æ—Å—Ç–∞–ª–æ—Å—å
   - `formatReadingTime()` - –≤—Ä–µ–º—è —á—Ç–µ–Ω–∏—è

2. `utils/validators.ts` - –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:
   - `validateEmail()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ email
   - `validatePassword()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
   - `validateRequired()` - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ
   - `validateNumber()` - —á–∏—Å–ª–æ–≤—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

3. `components/ui/ConnectionStatus.tsx` - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
   - –ó–∞–º–µ–Ω—è–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ª–æ–≥–∏–∫—É –∏–∑ Login/Register/Settings
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ (sm/md/lg)
   - –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Navbar:**
- –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é —Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –æ—Ç –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `isLibrarian` –¥–ª—è Readers, Borrow, Admin Books
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `isAdmin` –¥–ª—è Users
- **–§–∞–π–ª**: `frontend/src/components/layout/Navbar.tsx:227-266`

**–£–ª—É—á—à–µ–Ω–æ –≤ Library.tsx:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `formatDate` –∏ `daysRemaining` –∏–∑ utils
- –ó–∞–º–µ–Ω—ë–Ω `alert()` –Ω–∞ `toast.success()` –∏ `toast.error()`
- **–§–∞–π–ª**: `frontend/src/pages/Library.tsx`

#### –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–ß–∏—Ç–∞—Ç—å" –¥–ª—è –∞–¥–º–∏–Ω–æ–≤

**–í AdminBooks.tsx:**
- –ê–¥–º–∏–Ω—ã –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä–∏ –≤–∏–¥—è—Ç –∫–Ω–æ–ø–∫—É "–ß–∏—Ç–∞—Ç—å" –¥–ª—è –∫–Ω–∏–≥ —Å —Ñ–∞–π–ª–∞–º–∏
- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –≤ `/reader/:bookId`
- –ò–∫–æ–Ω–∫–∞ `BookMarked` –≤ primary —Ü–≤–µ—Ç–µ
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `book.files && book.files.length > 0`
- **–§–∞–π–ª**: `frontend/src/pages/AdminBooks.tsx:622-630`

### üìä –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

**–û–±–Ω–æ–≤–ª—ë–Ω GrantAccessDTO:**
- `days` —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã: `min=1, max=365`
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `granted_by` –¥–ª—è –∞—É–¥–∏—Ç–∞
- **–§–∞–π–ª**: `internal/models/dto.go:116-123`

## –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

‚úÖ Backend –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫  
‚úÖ Frontend —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ  
‚úÖ –ê–¥–º–∏–Ω—ã –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å –ª—é–±—ã–µ –∫–Ω–∏–≥–∏  
‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –±–∞–≥ —Å userID  
‚úÖ –£–ª—É—á—à–µ–Ω–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –¥–æ—Å—Ç—É–ø–∞  
‚úÖ –°–æ–∑–¥–∞–Ω—ã –Ω–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è  
‚úÖ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –≤ frontend  
‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –º–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é Navbar  

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### Backend (–≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞)

1. **–°–æ–∑–¥–∞—Ç—å Repository –¥–ª—è –Ω–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π:**
   - `CollectionRepository` –≤ `internal/repository/gorm/collection.go`
   - `BookmarkRepository` –≤ `internal/repository/gorm/bookmark.go`
   - `AnnotationRepository` –≤ `internal/repository/gorm/annotation.go`
   - `ReviewRepository` –≤ `internal/repository/gorm/review.go`

2. **–°–æ–∑–¥–∞—Ç—å Service –¥–ª—è –Ω–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π:**
   - `CollectionService` –≤ `internal/services/collection_service.go`
   - `BookmarkService` –≤ `internal/services/bookmark_service.go`
   - `AnnotationService` –≤ `internal/services/annotation_service.go`
   - `ReviewService` –≤ `internal/services/review_service.go`

3. **–°–æ–∑–¥–∞—Ç—å Handlers –∏ API endpoints:**
   ```
   POST   /api/v1/collections - —Å–æ–∑–¥–∞—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é
   GET    /api/v1/collections - –º–æ–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
   GET    /api/v1/collections/:id - –ø–æ–ª—É—á–∏—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é
   POST   /api/v1/collections/:id/books - –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥–∏
   DELETE /api/v1/collections/:id/books/:book_id - —É–±—Ä–∞—Ç—å –∫–Ω–∏–≥—É
   
   POST   /api/v1/bookmarks - —Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–ª–∞–¥–∫—É
   GET    /api/v1/bookmarks - –º–æ–∏ –∑–∞–∫–ª–∞–¥–∫–∏
   GET    /api/v1/books/:id/bookmarks - –∑–∞–∫–ª–∞–¥–∫–∏ –∫–Ω–∏–≥–∏
   
   POST   /api/v1/annotations - —Å–æ–∑–¥–∞—Ç—å –∞–Ω–Ω–æ—Ç–∞—Ü–∏—é
   GET    /api/v1/books/:id/annotations - –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –∫–Ω–∏–≥–∏
   
   POST   /api/v1/books/:id/reviews - –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤
   GET    /api/v1/books/:id/reviews - –æ—Ç–∑—ã–≤—ã –∫–Ω–∏–≥–∏
   GET    /api/v1/books/:id/reviews/stats - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
   ```

4. **–î–æ–±–∞–≤–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü:**
   - `004_add_collections_table.up.sql`
   - `005_add_bookmarks_table.up.sql`
   - `006_add_annotations_table.up.sql`
   - `007_add_reviews_table.up.sql`

5. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å Race Conditions:**
   - –û–±–µ—Ä–Ω—É—Ç—å GrantAccess –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ `borrowBookWithTransaction` –≤ BorrowService
   - –î–æ–±–∞–≤–∏—Ç—å `SELECT FOR UPDATE` –≥–¥–µ –Ω—É–∂–Ω–æ

6. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º:**
   - Book - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å BorrowedBook, BookAccess, Reviews
   - Reader - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å BorrowedBook
   - Category - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å Books
   - UserGroup - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å Users

### Frontend

1. **–°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ–∏—á:**
   - `pages/Collections.tsx` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏—è–º–∏
   - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–∫–ª–∞–¥–∫–∏ –≤ Reader.tsx
   - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –≤ Reader.tsx

2. **–£–ª—É—á—à–∏—Ç—å Reader.tsx:**
   - –î–æ–±–∞–≤–∏—Ç—å –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å —Å –∑–∞–∫–ª–∞–¥–∫–∞–º–∏
   - –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∞–Ω–Ω–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
   - –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –ø–æ–∑–∏—Ü–∏—é –≤ localStorage
   - –î–æ–±–∞–≤–∏—Ç—å –æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–∏–≥–∏ (TOC)

3. **–°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ—Ç–∑—ã–≤–æ–≤:**
   - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ—Ç–∑—ã–≤—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∫–Ω–∏–≥–∏
   - –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—Ç–∑—ã–≤–∞
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤

4. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ –±–∞–≥–∏:**
   - Borrow.tsx - –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ª–∏–º–∏—Ç–∞ 3 –∫–Ω–∏–≥–∏
   - Reader.tsx - –≤–∞–ª–∏–¥–∞—Ü–∏—è currentPage
   - Groups.tsx - –≤–∞–ª–∏–¥–∞—Ü–∏—è max_books –∏ loan_days
   - –ó–∞–º–µ–Ω–∏—Ç—å –æ—Å—Ç–∞–≤—à–∏–µ—Å—è `alert()` –∏ `confirm()` –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

5. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
   - –î–æ–±–∞–≤–∏—Ç—å React.memo –¥–ª—è BookCard
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å useMemo –¥–ª—è –¥–æ—Ä–æ–≥–∏—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
   - –î–æ–±–∞–≤–∏—Ç—å debounce –¥–ª—è –ø–æ–∏—Å–∫–∞

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **Backend unit tests:**
   - –¢–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–π/–∑–∞–∫–ª–∞–¥–æ–∫/–∞–Ω–Ω–æ—Ç–∞—Ü–∏–π

2. **Integration tests:**
   - –¢–µ—Å—Ç—ã –Ω–æ–≤—ã—Ö API endpoints
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

3. **Frontend tests:**
   - –¢–µ—Å—Ç—ã utils (formatters, validators)
   - –¢–µ—Å—Ç—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### Backend
- ‚ùó Race conditions –≤ GrantAccess –∏ BorrowBook (–Ω—É–∂–Ω—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)
- ‚ùó –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
- ‚ö†Ô∏è CopiesCount –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º
- ‚ö†Ô∏è –ù–µ—Ç FK constraint –Ω–∞ User.GroupID

### Frontend
- ‚ùó Borrow.tsx –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–∏–º–∏—Ç 3 –∫–Ω–∏–≥–∏ –ø–µ—Ä–µ–¥ –≤—ã–¥–∞—á–µ–π
- ‚ö†Ô∏è –ù–µ—Ç role guards –Ω–∞ route —É—Ä–æ–≤–Ω–µ (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–ª—å–∫–æ –≤ useEffect)
- ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏ –≤ async –æ–ø–µ—Ä–∞—Ü–∏—è—Ö
- ‚ö†Ô∏è –ù–µ—Ç retry –ª–æ–≥–∏–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

## –ú–µ—Ç—Ä–∏–∫–∏ —É–ª—É—á—à–µ–Ω–∏–π

- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–∞–≥–æ–≤**: 2
- **–£–ª—É—á—à–µ–Ω–æ –±–∏–∑–Ω–µ—Å-–ø—Ä–æ–≤–µ—Ä–æ–∫**: 6
- **–°–æ–∑–¥–∞–Ω–æ –Ω–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π**: 4
- **–°–æ–∑–¥–∞–Ωo —É—Ç–∏–ª–∏—Ç**: 2
- **–°–æ–∑–¥–∞–Ω–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤**: 1
- **–£—Å—Ç—Ä–∞–Ω–µ–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–π**: 5+
- **–°—Ç—Ä–æ–∫ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞**: ~500
- **–ù–æ–≤—ã—Ö API endpoints** (–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ): 15+

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è userID** —á–µ—Ä–µ–∑ `middleware.GetUserFromContext()`
2. **–†–∞—Å—à–∏—Ä—è–µ–º–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π** —Å 4 —Ç–∏–ø–∞–º–∏
3. **–ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø—É–±–ª–∏—á–Ω—ã—Ö/–ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö
4. **–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–∑—ã–≤–æ–≤** —Å —Ä–µ–π—Ç–∏–Ω–≥–∞–º–∏ –∏ –ª–∞–π–∫–∞–º–∏
5. **–ß–∏—Å—Ç—ã–π –∫–æ–¥ frontend** —Å –≤—ã–¥–µ–ª–µ–Ω–∏–µ–º utils –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
